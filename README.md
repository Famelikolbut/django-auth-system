# Кастомная система аутентификации и авторизации (Django + DRF + Docker)
## О проекте

Это backend-приложение, реализующее полноценную систему аутентификации и авторизации. Ключевой особенностью является собственная, продуманная система доступа к ресурсам на основе ролей (RBAC), которая не использует встроенные модели `Group` и `Permission` из `django.contrib.auth`.

Проект полностью докеризирован для легкого запуска и развертывания, использует PostgreSQL в качестве базы данных и JWT для аутентификации пользователей. Качество кода поддерживается с помощью `pre-commit` хуков и линтера/форматтера `Ruff`.

---

## Запуск и развертывание (с помощью Docker)

Проект настроен для максимально быстрого запуска в изолированном Docker-окружении.
**Предварительные требования:**
*   Установленный **Git**.
*   Установленный и запущенный **Docker Desktop**.

### 1. Клонирование репозитория
```bash
git clone https://github.com/Famelikolbut/django-auth-system.git
```
### 2. Создание файла окружения
Проект использует `.env` файл для хранения секретов и настроек.
```bash
# Для Windows (PowerShell)
copy .env.example .env

# Для macOS/Linux
cp .env.example .env
```
### 3. Сборка и запуск контейнеров
Эта команда соберет образ для Django-приложения, скачает образ PostgreSQL и запустит оба сервиса.
```bash
docker-compose up --build
```
### 4. Применение миграций
Дождитесь, пока оба контейнера запустятся. Затем откройте **второй терминал** и выполните команду, чтобы создать таблицы в базе данных и наполнить ее тестовыми данными:
```bash
docker-compose exec app python manage.py migrate
```
### 5. Готово!
*   **API доступно по адресу:** `http://localhost:8000/`
*   **База данных PostgreSQL доступна на порту:** `5432`

## Демонстрация и тестирование API

### Тестовые пользователи
Миграции автоматически создают двух пользователей для демонстрации прав доступа:

1.  **Администратор**
    *   **Логин:** `admin@example.com`
    *   **Пароль:** `adminpassword123`
    *   **Роль:** "Администратор" (имеет доступ ко всем эндпоинтам).

2.  **Обычный пользователь**
    *   **Логин:** `user@example.com`
    *   **Пароль:** `userpassword123`
    *   **Роль:** "Пользователь" (имеет ограниченные права).

### Ключевые эндпоинты и права доступа

| Эндпоинт                      | Метод         | Описание                                           | Доступ                                     |
| ----------------------------- | ------------- | -------------------------------------------------- | ------------------------------------------ |
| `/api/auth/register/`         | `POST`        | Регистрация нового пользователя.                   | **Публичный**                              |
| `/api/auth/login/`            | `POST`        | Получение JWT-токенов (access, refresh).           | **Публичный**                              |
| `/api/auth/me/`               | `GET`,`PATCH`,`DELETE` | Управление собственным профилем.                   | **Любой аутентифицированный пользователь** |
| `/api/public/`                | `GET`         | Mock-ресурс, доступный всем.                       | **Публичный**                              |
| `/api/docs/my/`               | `GET`         | Mock-ресурс "мои документы".                       | **Администратор**, **Пользователь**        |
| `/api/reports/financial/`     | `GET`         | Mock-ресурс "финансовый отчет".                    | **Только Администратор**                   |
| `/api/admin/roles/`           | `CRUD`        | Управление ролями.                                 | **Только Администратор**                   |
| `/api/admin/permissions/`     | `CRUD`        | Управление разрешениями.                           | **Только Администратор**                   |
| `/api/admin/assign-role/`     | `POST`,`DELETE` | Назначение/снятие ролей с пользователей.           | **Только Администратор**                   |

---

## Структура проекта

```text
.
├── .env.example              # Пример файла с переменными окружения
├── .git/
├── .gitignore
├── .pre-commit-config.yaml   # Конфигурация для pre-commit хуков
├── Dockerfile                # Инструкция по сборке Docker-образа для Django
├── apps/                     # Директория для всех приложений Django
│   ├── documents/            # Приложение с Mock-ресурсами
│   │   ├── migrations/
│   │   ├── apps.py
│   │   ├── models.py
│   │   ├── urls.py
│   │   └── views.py          # Mock-Views для демонстрации прав
│   └── users/                # Приложение для пользователей и прав доступа
│       ├── migrations/       # Миграции, включая миграцию с тестовыми данными
│       ├── admin_urls.py     # URL для API администрирования
│       ├── apps.py
│       ├── models.py         # Кастомная модель CustomUser, Role, Permission
│       ├── permissions.py    # Кастомный класс HasPermission - ядро системы авторизации
│       ├── serializers.py    # Сериализаторы для регистрации, логина, профиля, ролей
│       └── views.py          # Views для регистрации, логина, управления правами
├── config/                   # Директория с настройками проекта
│   ├── __init__.py
│   ├── asgi.py
│   ├── settings.py           # Главный файл настроек, читает переменные из .env
│   ├── urls.py               # Главный файл URL-маршрутизации
│   └── wsgi.py
├── docker-compose.yml        # Файл для оркестрации сервисов (app, db)
├── manage.py                 # Стандартная утилита Django
├── pyproject.toml            # Конфигурация для Ruff (линтер/форматтер)
├── requirements-dev.txt      # Зависимости для локальной разработки (pre-commit)
└── requirements.txt          # Основные зависимости проекта
